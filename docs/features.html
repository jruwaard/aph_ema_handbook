<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Ecological Momentary Assessment in Mental Health Research</title>
  <meta name="description" content="This is an Amsterdam Public Health (APH) Research Manual, written for researchers who are planning Ecological Momentary Assessment (EMA) studies.">
  <meta name="generator" content="bookdown 0.7.13 and GitBook 2.6.7">

  <meta property="og:title" content="Ecological Momentary Assessment in Mental Health Research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover/smallcover.jpg" />
  <meta property="og:description" content="This is an Amsterdam Public Health (APH) Research Manual, written for researchers who are planning Ecological Momentary Assessment (EMA) studies." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Ecological Momentary Assessment in Mental Health Research" />
  
  <meta name="twitter:description" content="This is an Amsterdam Public Health (APH) Research Manual, written for researchers who are planning Ecological Momentary Assessment (EMA) studies." />
  <meta name="twitter:image" content="images/cover/smallcover.jpg" />

<meta name="author" content="Jeroen Ruwaard">
<meta name="author" content="Lisa Kooistra">
<meta name="author" content="Melissa Thong">


<meta name="date" content="2018-11-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="activity.html">
<link rel="next" href="lmm.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { text-decoration: underline; } /* DataType */
code > span.co { font-style: italic; } /* Comment */
code > span.al { font-weight: bold; } /* Alert */
code > span.er { font-weight: bold; } /* Error */
code > span.wa { font-style: italic; } /* Warning */
code > span.cf { font-weight: bold; } /* ControlFlow */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.do { font-style: italic; } /* Documentation */
code > span.an { font-style: italic; } /* Annotation */
code > span.cv { font-style: italic; } /* CommentVar */
code > span.in { font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EMA research Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introducing EMA</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-ema"><i class="fa fa-check"></i><b>1.1</b> What is EMA?</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#active-versus-passive-ema"><i class="fa fa-check"></i><b>1.1.1</b> Active versus Passive EMA</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#ema-sampling"><i class="fa fa-check"></i><b>1.1.2</b> EMA Sampling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#why-ema"><i class="fa fa-check"></i><b>1.2</b> Why EMA?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#to-minimize-recall-bias"><i class="fa fa-check"></i><b>1.2.1</b> To Minimize Recall Bias</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#to-maximize-ecological-validity"><i class="fa fa-check"></i><b>1.2.2</b> To Maximize Ecological Validity</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#to-advance-ideographic-research"><i class="fa fa-check"></i><b>1.2.3</b> To Advance Ideographic Research</a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction.html"><a href="introduction.html#to-enable-emi"><i class="fa fa-check"></i><b>1.2.4</b> To Enable EMI</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#ema-research-findings-a-birds-eye-view"><i class="fa fa-check"></i><b>1.3</b> EMA Research Findings: A Birds-eye View</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#active-ema"><i class="fa fa-check"></i><b>1.3.1</b> Active EMA</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#passive-ema"><i class="fa fa-check"></i><b>1.3.2</b> Passive EMA</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#limitations"><i class="fa fa-check"></i><b>1.3.3</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-is-in-this-manual"><i class="fa fa-check"></i><b>1.4</b> What is in this Manual?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2</b> Introducing R &amp; RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="rstudio.html"><a href="rstudio.html#what-are-r-and-rstudio"><i class="fa fa-check"></i><b>2.1</b> What are R and RStudio?</a></li>
<li class="chapter" data-level="2.2" data-path="rstudio.html"><a href="rstudio.html#why-r"><i class="fa fa-check"></i><b>2.2</b> Why R?</a></li>
<li class="chapter" data-level="2.3" data-path="rstudio.html"><a href="rstudio.html#installing-r-rstudio"><i class="fa fa-check"></i><b>2.3</b> Installing R &amp; RStudio</a></li>
<li class="chapter" data-level="2.4" data-path="rstudio.html"><a href="rstudio.html#interacting-with-r-through-the-rstudio-console"><i class="fa fa-check"></i><b>2.4</b> Interacting with R through the RStudio Console</a></li>
<li class="chapter" data-level="2.5" data-path="rstudio.html"><a href="rstudio.html#writing-r-scripts"><i class="fa fa-check"></i><b>2.5</b> Writing R-scripts</a></li>
<li class="chapter" data-level="2.6" data-path="rstudio.html"><a href="rstudio.html#importing-your-data"><i class="fa fa-check"></i><b>2.6</b> Importing Your Data</a><ul>
<li class="chapter" data-level="2.6.1" data-path="rstudio.html"><a href="rstudio.html#using-rstudio-menus-to-import-data"><i class="fa fa-check"></i><b>2.6.1</b> Using RStudio Menus to Import Data</a></li>
<li class="chapter" data-level="2.6.2" data-path="rstudio.html"><a href="rstudio.html#using-functions-to-import-data"><i class="fa fa-check"></i><b>2.6.2</b> Using Functions to Import Data</a></li>
<li class="chapter" data-level="2.6.3" data-path="rstudio.html"><a href="rstudio.html#accessing-your-data"><i class="fa fa-check"></i><b>2.6.3</b> Accessing your Data</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="rstudio.html"><a href="rstudio.html#extending-r-with-packages"><i class="fa fa-check"></i><b>2.7</b> Extending R with Packages</a><ul>
<li class="chapter" data-level="2.7.1" data-path="rstudio.html"><a href="rstudio.html#installing-r-packages-from-cran"><i class="fa fa-check"></i><b>2.7.1</b> Installing R-packages from CRAN</a></li>
<li class="chapter" data-level="2.7.2" data-path="rstudio.html"><a href="rstudio.html#installing-r-packages-from-github"><i class="fa fa-check"></i><b>2.7.2</b> Installing R-packages from GitHub</a></li>
<li class="chapter" data-level="2.7.3" data-path="rstudio.html"><a href="rstudio.html#using-packages"><i class="fa fa-check"></i><b>2.7.3</b> Using Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="rstudio.html"><a href="rstudio.html#getting-help"><i class="fa fa-check"></i><b>2.8</b> Getting Help</a><ul>
<li class="chapter" data-level="2.8.1" data-path="rstudio.html"><a href="rstudio.html#using-to-consult-the-documentation"><i class="fa fa-check"></i><b>2.8.1</b> Using ‘?’ to Consult the Documentation</a></li>
<li class="chapter" data-level="2.8.2" data-path="rstudio.html"><a href="rstudio.html#using-rstudios-global-documentation-index-search"><i class="fa fa-check"></i><b>2.8.2</b> Using RStudio’s Global Documentation Index Search</a></li>
<li class="chapter" data-level="2.8.3" data-path="rstudio.html"><a href="rstudio.html#learning-from-examples"><i class="fa fa-check"></i><b>2.8.3</b> Learning from Examples</a></li>
<li class="chapter" data-level="2.8.4" data-path="rstudio.html"><a href="rstudio.html#google"><i class="fa fa-check"></i><b>2.8.4</b> Google</a></li>
<li class="chapter" data-level="2.8.5" data-path="rstudio.html"><a href="rstudio.html#read-books"><i class="fa fa-check"></i><b>2.8.5</b> Read Books</a></li>
<li class="chapter" data-level="2.8.6" data-path="rstudio.html"><a href="rstudio.html#online-courses"><i class="fa fa-check"></i><b>2.8.6</b> Online Courses</a></li>
<li class="chapter" data-level="2.8.7" data-path="rstudio.html"><a href="rstudio.html#learn-r-in-r"><i class="fa fa-check"></i><b>2.8.7</b> Learn R, in R</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II EMA Methods</b></span></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Study Design</a><ul>
<li class="chapter" data-level="3.1" data-path="methods.html"><a href="methods.html#what-is-the-ema-research-question"><i class="fa fa-check"></i><b>3.1</b> What is the EMA Research Question?</a></li>
<li class="chapter" data-level="3.2" data-path="methods.html"><a href="methods.html#who-are-the-study-participants"><i class="fa fa-check"></i><b>3.2</b> Who are the Study Participants?</a></li>
<li class="chapter" data-level="3.3" data-path="methods.html"><a href="methods.html#what-are-the-qualities-of-the-ema-measures"><i class="fa fa-check"></i><b>3.3</b> What are the Qualities of the EMA Measures?</a></li>
<li class="chapter" data-level="3.4" data-path="methods.html"><a href="methods.html#what-is-the-sample-plan"><i class="fa fa-check"></i><b>3.4</b> What is the Sample Plan?</a></li>
<li class="chapter" data-level="3.5" data-path="methods.html"><a href="methods.html#what-is-the-optimal-sample-size"><i class="fa fa-check"></i><b>3.5</b> What is the Optimal Sample Size?</a></li>
<li class="chapter" data-level="3.6" data-path="methods.html"><a href="methods.html#what-are-the-ethical-aspects"><i class="fa fa-check"></i><b>3.6</b> What are the Ethical Aspects?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="instruments.html"><a href="instruments.html"><i class="fa fa-check"></i><b>4</b> EMA instruments</a><ul>
<li class="chapter" data-level="4.1" data-path="instruments.html"><a href="instruments.html#general-considerations"><i class="fa fa-check"></i><b>4.1</b> General considerations</a><ul>
<li class="chapter" data-level="4.1.1" data-path="instruments.html"><a href="instruments.html#custom-development-vs.existing-platform"><i class="fa fa-check"></i><b>4.1.1</b> Custom Development vs. Existing Platform</a></li>
<li class="chapter" data-level="4.1.2" data-path="instruments.html"><a href="instruments.html#low-tech-versus-high-tech"><i class="fa fa-check"></i><b>4.1.2</b> Low-tech versus High-Tech</a></li>
<li class="chapter" data-level="4.1.3" data-path="instruments.html"><a href="instruments.html#access-to-a-back-office"><i class="fa fa-check"></i><b>4.1.3</b> Access to a Back-office</a></li>
<li class="chapter" data-level="4.1.4" data-path="instruments.html"><a href="instruments.html#validity-and-reliability"><i class="fa fa-check"></i><b>4.1.4</b> Validity and Reliability</a></li>
<li class="chapter" data-level="4.1.5" data-path="instruments.html"><a href="instruments.html#data-access"><i class="fa fa-check"></i><b>4.1.5</b> Data access</a></li>
<li class="chapter" data-level="4.1.6" data-path="instruments.html"><a href="instruments.html#demands-on-time"><i class="fa fa-check"></i><b>4.1.6</b> Demands on Time</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="instruments.html"><a href="instruments.html#technical-considerations"><i class="fa fa-check"></i><b>4.2</b> Technical Considerations</a><ul>
<li class="chapter" data-level="4.2.1" data-path="instruments.html"><a href="instruments.html#internet-access"><i class="fa fa-check"></i><b>4.2.1</b> Internet Access</a></li>
<li class="chapter" data-level="4.2.2" data-path="instruments.html"><a href="instruments.html#device-limitations"><i class="fa fa-check"></i><b>4.2.2</b> Device Limitations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="instruments.html"><a href="instruments.html#participant-perspective"><i class="fa fa-check"></i><b>4.3</b> Participant Perspective</a></li>
<li class="chapter" data-level="4.4" data-path="instruments.html"><a href="instruments.html#points-to-consider"><i class="fa fa-check"></i><b>4.4</b> Points to Consider</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datamanagement.html"><a href="datamanagement.html"><i class="fa fa-check"></i><b>5</b> Data Management</a><ul>
<li class="chapter" data-level="5.1" data-path="datamanagement.html"><a href="datamanagement.html#using-rstudio-projects"><i class="fa fa-check"></i><b>5.1</b> Using RStudio-projects</a></li>
<li class="chapter" data-level="5.2" data-path="datamanagement.html"><a href="datamanagement.html#an-example-project-directory-structure"><i class="fa fa-check"></i><b>5.2</b> An Example Project Directory Structure</a></li>
<li class="chapter" data-level="5.3" data-path="datamanagement.html"><a href="datamanagement.html#data"><i class="fa fa-check"></i><b>5.3</b> Data</a></li>
<li class="chapter" data-level="5.4" data-path="datamanagement.html"><a href="datamanagement.html#import-scripts"><i class="fa fa-check"></i><b>5.4</b> Import Scripts</a></li>
<li class="chapter" data-level="5.5" data-path="datamanagement.html"><a href="datamanagement.html#reproducible-analyses"><i class="fa fa-check"></i><b>5.5</b> Reproducible Analyses</a></li>
<li class="chapter" data-level="5.6" data-path="datamanagement.html"><a href="datamanagement.html#readme"><i class="fa fa-check"></i><b>5.6</b> README</a></li>
<li class="chapter" data-level="5.7" data-path="datamanagement.html"><a href="datamanagement.html#a-final-note"><i class="fa fa-check"></i><b>5.7</b> A Final Note</a></li>
</ul></li>
<li class="part"><span><b>III EMA Outcomes</b></span></li>
<li class="chapter" data-level="6" data-path="mood.html"><a href="mood.html"><i class="fa fa-check"></i><b>6</b> Mood</a><ul>
<li class="chapter" data-level="6.1" data-path="mood.html"><a href="mood.html#unidimensional-mood-assessment"><i class="fa fa-check"></i><b>6.1</b> Unidimensional Mood Assessment</a><ul>
<li class="chapter" data-level="6.1.1" data-path="mood.html"><a href="mood.html#bipolar-unidimensional-items"><i class="fa fa-check"></i><b>6.1.1</b> Bipolar Unidimensional Items</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="mood.html"><a href="mood.html#bag-of-items"><i class="fa fa-check"></i><b>6.2</b> Bag-of-Items</a></li>
<li class="chapter" data-level="6.3" data-path="mood.html"><a href="mood.html#multi-dimensional-mood-assessment"><i class="fa fa-check"></i><b>6.3</b> Multi-dimensional Mood Assessment</a><ul>
<li class="chapter" data-level="6.3.1" data-path="mood.html"><a href="mood.html#the-circumplex-model"><i class="fa fa-check"></i><b>6.3.1</b> The Circumplex Model</a></li>
<li class="chapter" data-level="6.3.2" data-path="mood.html"><a href="mood.html#negative-positive-affect"><i class="fa fa-check"></i><b>6.3.2</b> Negative &amp; Positive Affect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="activity.html"><a href="activity.html"><i class="fa fa-check"></i><b>7</b> Activity</a><ul>
<li class="chapter" data-level="7.1" data-path="activity.html"><a href="activity.html#actigraphy"><i class="fa fa-check"></i><b>7.1</b> Actigraphy</a><ul>
<li class="chapter" data-level="7.1.1" data-path="activity.html"><a href="activity.html#data-cleaning"><i class="fa fa-check"></i><b>7.1.1</b> Data cleaning</a></li>
<li class="chapter" data-level="7.1.2" data-path="activity.html"><a href="activity.html#feature-extraction"><i class="fa fa-check"></i><b>7.1.2</b> Feature Extraction</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="activity.html"><a href="activity.html#geotracking"><i class="fa fa-check"></i><b>7.2</b> Geotracking</a><ul>
<li class="chapter" data-level="7.2.1" data-path="activity.html"><a href="activity.html#the-geographic-coordinate-system"><i class="fa fa-check"></i><b>7.2.1</b> The Geographic Coordinate System</a></li>
<li class="chapter" data-level="7.2.2" data-path="activity.html"><a href="activity.html#the-global-positioning-system"><i class="fa fa-check"></i><b>7.2.2</b> The Global Positioning System</a></li>
<li class="chapter" data-level="7.2.3" data-path="activity.html"><a href="activity.html#gps-based-activity-measures"><i class="fa fa-check"></i><b>7.2.3</b> GPS-based Activity Measures</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Analytic Approaches</b></span></li>
<li class="chapter" data-level="8" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>8</b> Feature Extraction</a><ul>
<li class="chapter" data-level="8.1" data-path="features.html"><a href="features.html#simulated-ema-time-series-example"><i class="fa fa-check"></i><b>8.1</b> Simulated EMA Time-series Example</a></li>
<li class="chapter" data-level="8.2" data-path="features.html"><a href="features.html#central-tendency-and-variability"><i class="fa fa-check"></i><b>8.2</b> Central Tendency and Variability</a></li>
<li class="chapter" data-level="8.3" data-path="features.html"><a href="features.html#modelling-the-trend"><i class="fa fa-check"></i><b>8.3</b> Modelling the Trend</a></li>
<li class="chapter" data-level="8.4" data-path="features.html"><a href="features.html#missing-values"><i class="fa fa-check"></i><b>8.4</b> Missing Values</a></li>
<li class="chapter" data-level="8.5" data-path="features.html"><a href="features.html#auto-correlation"><i class="fa fa-check"></i><b>8.5</b> Auto-correlation</a><ul>
<li class="chapter" data-level="8.5.1" data-path="features.html"><a href="features.html#rolling-statistics"><i class="fa fa-check"></i><b>8.5.1</b> Rolling Statistics</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="features.html"><a href="features.html#periodicity"><i class="fa fa-check"></i><b>8.6</b> Periodicity</a></li>
<li class="chapter" data-level="8.7" data-path="features.html"><a href="features.html#discussion"><i class="fa fa-check"></i><b>8.7</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lmm.html"><a href="lmm.html"><i class="fa fa-check"></i><b>9</b> Mixed Modeling</a><ul>
<li class="chapter" data-level="9.1" data-path="lmm.html"><a href="lmm.html#the-mixed-model"><i class="fa fa-check"></i><b>9.1</b> The Mixed Model</a></li>
<li class="chapter" data-level="9.2" data-path="lmm.html"><a href="lmm.html#simulating-example-data"><i class="fa fa-check"></i><b>9.2</b> Simulating Example Data</a></li>
<li class="chapter" data-level="9.3" data-path="lmm.html"><a href="lmm.html#fitting-a-mixed-model-in-r"><i class="fa fa-check"></i><b>9.3</b> Fitting a Mixed Model in R</a></li>
<li class="chapter" data-level="9.4" data-path="lmm.html"><a href="lmm.html#adding-time-as-a-predictor"><i class="fa fa-check"></i><b>9.4</b> Adding Time as a Predictor</a></li>
<li class="chapter" data-level="9.5" data-path="lmm.html"><a href="lmm.html#adding-a-two-group-comparison"><i class="fa fa-check"></i><b>9.5</b> Adding a Two-Group Comparison</a></li>
<li class="chapter" data-level="9.6" data-path="lmm.html"><a href="lmm.html#next-steps"><i class="fa fa-check"></i><b>9.6</b> Next Steps</a></li>
</ul></li>
<li class="part"><span><b>V A Case Study</b></span></li>
<li class="chapter" data-level="10" data-path="csd.html"><a href="csd.html"><i class="fa fa-check"></i><b>10</b> Early Warning Signs of Depression</a><ul>
<li class="chapter" data-level="10.1" data-path="csd.html"><a href="csd.html#critical-slowing-down"><i class="fa fa-check"></i><b>10.1</b> Critical Slowing Down</a></li>
<li class="chapter" data-level="10.2" data-path="csd.html"><a href="csd.html#plotting-the-course-of-depression"><i class="fa fa-check"></i><b>10.2</b> Plotting the Course of Depression</a></li>
<li class="chapter" data-level="10.3" data-path="csd.html"><a href="csd.html#mental-state-ema-items"><i class="fa fa-check"></i><b>10.3</b> Mental state EMA Items</a></li>
<li class="chapter" data-level="10.4" data-path="csd.html"><a href="csd.html#running-the-dfa"><i class="fa fa-check"></i><b>10.4</b> Running the DFA</a></li>
<li class="chapter" data-level="10.5" data-path="csd.html"><a href="csd.html#results"><i class="fa fa-check"></i><b>10.5</b> Results</a></li>
<li class="chapter" data-level="10.6" data-path="csd.html"><a href="csd.html#discussion-1"><i class="fa fa-check"></i><b>10.6</b> Discussion</a></li>
</ul></li>
<li class="part"><span><b>VI EMA Catalogues</b></span></li>
<li class="chapter" data-level="11" data-path="catalogue.html"><a href="catalogue.html"><i class="fa fa-check"></i><b>11</b> EMA Research within the APH Mental Health Consortium</a><ul>
<li class="chapter" data-level="11.1" data-path="catalogue.html"><a href="catalogue.html#depression"><i class="fa fa-check"></i><b>11.1</b> Depression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="catalogue.html"><a href="catalogue.html#bockting"><i class="fa fa-check"></i><b>11.1.1</b> Bockting</a></li>
<li class="chapter" data-level="11.1.2" data-path="catalogue.html"><a href="catalogue.html#penninx-and-lamers"><i class="fa fa-check"></i><b>11.1.2</b> Penninx and Lamers</a></li>
<li class="chapter" data-level="11.1.3" data-path="catalogue.html"><a href="catalogue.html#riper-and-smit"><i class="fa fa-check"></i><b>11.1.3</b> Riper and Smit</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="catalogue.html"><a href="catalogue.html#psychosomatic-symptoms"><i class="fa fa-check"></i><b>11.2</b> Psychosomatic Symptoms</a><ul>
<li class="chapter" data-level="11.2.1" data-path="catalogue.html"><a href="catalogue.html#knoop"><i class="fa fa-check"></i><b>11.2.1</b> Knoop</a></li>
<li class="chapter" data-level="11.2.2" data-path="catalogue.html"><a href="catalogue.html#sprangers"><i class="fa fa-check"></i><b>11.2.2</b> Sprangers</a></li>
<li class="chapter" data-level="11.2.3" data-path="catalogue.html"><a href="catalogue.html#snoek"><i class="fa fa-check"></i><b>11.2.3</b> Snoek</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="catalogue.html"><a href="catalogue.html#suicidal-ideation"><i class="fa fa-check"></i><b>11.3</b> Suicidal Ideation</a><ul>
<li class="chapter" data-level="11.3.1" data-path="catalogue.html"><a href="catalogue.html#van-ballegooijen"><i class="fa fa-check"></i><b>11.3.1</b> Van Ballegooijen</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="catalogue.html"><a href="catalogue.html#psychotic-symptoms"><i class="fa fa-check"></i><b>11.4</b> Psychotic symptoms</a><ul>
<li class="chapter" data-level="11.4.1" data-path="catalogue.html"><a href="catalogue.html#van-der-gaag"><i class="fa fa-check"></i><b>11.4.1</b> Van der Gaag</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="catalogue.html"><a href="catalogue.html#sleep"><i class="fa fa-check"></i><b>11.5</b> Sleep</a><ul>
<li class="chapter" data-level="11.5.1" data-path="catalogue.html"><a href="catalogue.html#van-someren"><i class="fa fa-check"></i><b>11.5.1</b> Van Someren</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="catalogue.html"><a href="catalogue.html#stress-emotion"><i class="fa fa-check"></i><b>11.6</b> Stress &amp; Emotion</a><ul>
<li class="chapter" data-level="11.6.1" data-path="catalogue.html"><a href="catalogue.html#de-geus"><i class="fa fa-check"></i><b>11.6.1</b> De Geus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html"><i class="fa fa-check"></i><b>12</b> EMA Instruments Catalogue</a><ul>
<li class="chapter" data-level="12.1" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#ema-platforms-apps"><i class="fa fa-check"></i><b>12.1</b> EMA Platforms &amp; Apps</a><ul>
<li class="chapter" data-level="12.1.1" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#ilumivu"><i class="fa fa-check"></i><b>12.1.1</b> Ilumivu</a></li>
<li class="chapter" data-level="12.1.2" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#moodbuster"><i class="fa fa-check"></i><b>12.1.2</b> Moodbuster</a></li>
<li class="chapter" data-level="12.1.3" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#movisens"><i class="fa fa-check"></i><b>12.1.3</b> Movisens</a></li>
<li class="chapter" data-level="12.1.4" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#psymate"><i class="fa fa-check"></i><b>12.1.4</b> PsyMate</a></li>
<li class="chapter" data-level="12.1.5" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#roqua"><i class="fa fa-check"></i><b>12.1.5</b> RoQua</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#wearables"><i class="fa fa-check"></i><b>12.2</b> Wearables</a><ul>
<li class="chapter" data-level="12.2.1" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#geneactive"><i class="fa fa-check"></i><b>12.2.1</b> GENEActive</a></li>
<li class="chapter" data-level="12.2.2" data-path="ema-instruments-catalogue.html"><a href="ema-instruments-catalogue.html#vu-ams"><i class="fa fa-check"></i><b>12.2.2</b> VU-AMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rcat.html"><a href="rcat.html"><i class="fa fa-check"></i><b>13</b> R Packages for EMA Research</a><ul>
<li class="chapter" data-level="13.1" data-path="rcat.html"><a href="rcat.html#accelerometry"><i class="fa fa-check"></i><b>13.1</b> Accelerometry</a><ul>
<li class="chapter" data-level="13.1.1" data-path="rcat.html"><a href="rcat.html#genearead"><i class="fa fa-check"></i><b>13.1.1</b> GENEAread</a></li>
<li class="chapter" data-level="13.1.2" data-path="rcat.html"><a href="rcat.html#ggir"><i class="fa fa-check"></i><b>13.1.2</b> GGIR</a></li>
<li class="chapter" data-level="13.1.3" data-path="rcat.html"><a href="rcat.html#physicalactivity"><i class="fa fa-check"></i><b>13.1.3</b> PhysicalActivity</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rcat.html"><a href="rcat.html#data-management-visual-exploration"><i class="fa fa-check"></i><b>13.2</b> Data management &amp; Visual Exploration</a><ul>
<li class="chapter" data-level="13.2.1" data-path="rcat.html"><a href="rcat.html#dplyr"><i class="fa fa-check"></i><b>13.2.1</b> dplyr</a></li>
<li class="chapter" data-level="13.2.2" data-path="rcat.html"><a href="rcat.html#ggplot2"><i class="fa fa-check"></i><b>13.2.2</b> ggplot2</a></li>
<li class="chapter" data-level="13.2.3" data-path="rcat.html"><a href="rcat.html#haven"><i class="fa fa-check"></i><b>13.2.3</b> haven</a></li>
<li class="chapter" data-level="13.2.4" data-path="rcat.html"><a href="rcat.html#lubridate"><i class="fa fa-check"></i><b>13.2.4</b> lubridate</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rcat.html"><a href="rcat.html#mixed-effects-modeling"><i class="fa fa-check"></i><b>13.3</b> Mixed-effects Modeling</a><ul>
<li class="chapter" data-level="13.3.1" data-path="rcat.html"><a href="rcat.html#nlme"><i class="fa fa-check"></i><b>13.3.1</b> nlme</a></li>
<li class="chapter" data-level="13.3.2" data-path="rcat.html"><a href="rcat.html#lme4"><i class="fa fa-check"></i><b>13.3.2</b> lme4</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rcat.html"><a href="rcat.html#power-analysis"><i class="fa fa-check"></i><b>13.4</b> Power analysis</a><ul>
<li class="chapter" data-level="13.4.1" data-path="rcat.html"><a href="rcat.html#simr"><i class="fa fa-check"></i><b>13.4.1</b> simr</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="rcat.html"><a href="rcat.html#symptom-network-analysis"><i class="fa fa-check"></i><b>13.5</b> Symptom Network Analysis</a><ul>
<li class="chapter" data-level="13.5.1" data-path="rcat.html"><a href="rcat.html#autovarcore"><i class="fa fa-check"></i><b>13.5.1</b> autovarCore</a></li>
<li class="chapter" data-level="13.5.2" data-path="rcat.html"><a href="rcat.html#qgraph"><i class="fa fa-check"></i><b>13.5.2</b> qgraph</a></li>
<li class="chapter" data-level="13.5.3" data-path="rcat.html"><a href="rcat.html#bootnet"><i class="fa fa-check"></i><b>13.5.3</b> bootnet</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="rcat.html"><a href="rcat.html#timeseries-analysis"><i class="fa fa-check"></i><b>13.6</b> Timeseries analysis</a><ul>
<li class="chapter" data-level="13.6.1" data-path="rcat.html"><a href="rcat.html#lomb"><i class="fa fa-check"></i><b>13.6.1</b> lomb</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Closing Matters</b></span></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ecological Momentary Assessment in Mental Health Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="features" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Feature Extraction</h1>
<p>EMA data are streams: time-series that represent processes which may span hours, days, weeks or even months. To the beginning EMA researcher, it may not be immediately clear how to deal with these data. How, for example, can these series be summarized to study differences between individuals or changes within individuals over time? What ‘qualities’ or ‘features’ of a time-series should be considered? What are the available options? In this chapter, we will discuss some of the features that can be extracted from EMA time-series.</p>
<div id="simulated-ema-time-series-example" class="section level2">
<h2><span class="header-section-number">8.1</span> Simulated EMA Time-series Example</h2>
<p>We will focus on a simulated three-week time-series of EMA mood responses of a single person, in which ratings were collected five times per day. Figure <a href="features.html#fig:fig8a">8.1</a> shows a plot of the simulated scores.</p>
<p>Stare at the figure for a moment. How would you characterize the development of scores over time? What features would you want to extract? How would you quantify these features?</p>
<div class="figure" style="text-align: center"><span id="fig:fig8a"></span>
<img src="features_files/figure-html/fig8a-1.png" alt="A simulated three-week time-series of EMA mood ratings." width="100%" />
<p class="caption">
Figure 8.1: A simulated three-week time-series of EMA mood ratings.
</p>
</div>
</div>
<div id="central-tendency-and-variability" class="section level2">
<h2><span class="header-section-number">8.2</span> Central Tendency and Variability</h2>
<p>Features do not necessarily have to be complex. Familiar measures of central tendency of EMA time-series, such as the mode or the mean, can be useful predictors of traditional clinical assessments. Standard measures of the variability of EMA scores, such as the standard deviation (SD), have been shown to have diagnostic value (see, e.g., <span class="citation">R. Bowen, Baetz, Hawkes, &amp; Bowen (<a href="#ref-bowen2006">2006</a>)</span>). You should not hesitate to consider these statistics when they help you to answer your research question.</p>
<p> You should check, though, whether the implicit assumptions behind the statistics are correct. When you use the mean and the standard deviation to summarize a time-series, you assume that the data-generating process behind the series is stable over time - in technical terms: that this process is <em>stationary</em> <span class="citation">(Wikipedia, <a href="#ref-wikiStationary">2018</a>)</span>. If this assumption is incorrect (i.e., if the process is unstable or non-stationary), the mean and SD are biased statistics.</p>
<p>Our simulated EMA time-series is non-stationary, as can be seen in Figure <a href="features.html#fig:fig8b">8.2</a>. We observe a trend: the mood of the person increases over time. EMA scores tend to be below the mean in the beginning, and above the mean at the end. The overall mean (<em>M</em> = 4.4) overestimates the EMA scores of the first week (<em>M</em> = 3.3), and underestimates the scores of the last week (<em>M</em> = 5.5). If you use the overall mean as a feature of the time-series in your analyses, you ignore the mood improvements over the three-week period. In clinical research, your would probably not want to miss this other important feature.</p>
<p>When a trend exists in a series, the overall standard deviation is overestimated, because of the extra variability that is introduced by the changes of the mean. This can be checked by comparing the SD of the full series to the SD of smaller parts. In our example, the overall SD is 2.4. If we calculate the average of the SD of scores of each day, however, the estimated SD is 1.8. If the additional variability introduced by the trend is cancelled out, our estimate of variability decreases considerably.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8b"></span>
<img src="features_files/figure-html/fig8b-1.png" alt="EMA time-series, with reference lines for the mean (red line) and the mean +/- 1 standard deviation range (the area between the two blue lines). Both statistics are informative, but obviously do not do full justice to the variation in observations over time." width="100%" />
<p class="caption">
Figure 8.2: EMA time-series, with reference lines for the mean (red line) and the mean +/- 1 standard deviation range (the area between the two blue lines). Both statistics are informative, but obviously do not do full justice to the variation in observations over time.
</p>
</div>
</div>
<div id="modelling-the-trend" class="section level2">
<h2><span class="header-section-number">8.3</span> Modelling the Trend</h2>
<p>Now that we know that the overall mean and SD are sub-optimal features of this time-series, the question is how we can do better. What other features can we extract? One option would be to characterize the series in simple regression terms, via an intercept and a slope. By doing so, we can economically describe the dynamics of the series with two numbers. As can be seen in Figure <a href="features.html#fig:fig8c">8.3</a>, the regression model provides a more realistic and informative summary. At the start, the estimated mean - the intercept - is 3.2. This mean increases approximately 0.9 points per week (the slope), to a final estimated mean of 5.9. Comparing Figure <a href="features.html#fig:fig8b">8.2</a> and Figure <a href="features.html#fig:fig8c">8.3</a>, we see that Figure <a href="features.html#fig:fig8c">8.3</a> is more successful in capturing the variation in the series.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8c"></span>
<img src="features_files/figure-html/fig8c-1.png" alt="EMA time-series, with a regression reference line (red) and the residual error SD range around this line (the area between the two blue lines)" width="100%" />
<p class="caption">
Figure 8.3: EMA time-series, with a regression reference line (red) and the residual error SD range around this line (the area between the two blue lines)
</p>
</div>
<p>By using regression, we can also find a better estimate of the SD. Remember how the SD is conceptually defined as the average distance between the scores and the mean. Since the mean is modeled by the regression line, we can estimate the SD by calculating the standard deviation of the residuals of the regression model that we used to retrieve the intercept and slope. For our series, this results in an estimated SD of 2.3. The new SD estimate is smaller than the overall SD, as expected. By accounting for the extra variability introduced by the trend, we get a more accurate estimate of the variability around the mean at each point in time. However, the new estimate is still higher than the daily estimate that we calculated above. Figure <a href="features.html#fig:fig8d">8.4</a> provides a first indication of what is going on. In the figure, absolution regression residuals are plotted over time, with a regression line superposed. This reveals that residuals increase as time goes by. We discovered a new feature of the series: heteroscedasticity.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8d"></span>
<img src="features_files/figure-html/fig8d-1.png" alt="Plot of absolute regression residuals over time, revealing heteroscedasticity." width="100%" />
<p class="caption">
Figure 8.4: Plot of absolute regression residuals over time, revealing heteroscedasticity.
</p>
</div>
</div>
<div id="missing-values" class="section level2">
<h2><span class="header-section-number">8.4</span> Missing Values</h2>

<p>In EMA research, you should be prepared to deal with missing values. Especially with active EMA, in which participants have to consciously respond to prompted questions several times a day, non-response is inevitable. Missing values are typically considered to be a nuisance rather than a feature of EMA time-series. Non-response, however, is an important characteristic, that may even have clinical relevance. Missing values are also present in our simulated EMA time-series example, as you may have found out already when you inspected Figure <a href="features.html#fig:fig8a">8.1</a>. The points, denoting the observed responses, are denser in the beginning of the series. Over the course of the study period, the probability of missed ratings increases. This becomes immediately clear from Figure <a href="features.html#fig:fig8e">8.5</a>, in which the percentage of missed ratings is plotted per day. Every week, the probability of missed ratings increases approximately 16%.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8e"></span>
<img src="features_files/figure-html/fig8e-1.png" alt="Percentage of missed mood ratings, per day, over the three-week study period, with a regression line (red) superposed, revealing a familiar trend in EMA data." width="100%" />
<p class="caption">
Figure 8.5: Percentage of missed mood ratings, per day, over the three-week study period, with a regression line (red) superposed, revealing a familiar trend in EMA data.
</p>
</div>
<p>Now that we now about these missing values, the question arises how to deal with them? You can choose to ignore the missing values (assuming that the occurrence of missing values was driven by a completely random process). Alternatively, you could try to replace the missing values with plausible values (in which case it becomes important to think about the process that drives the missingness). If you decide to impute, there are several options. For example, you can replace missing values with the mean, the last-known value, an interpolated value or with a smoothing technique such as the Kalman-filter <span class="citation">(see Hoogendoorn &amp; Funk, <a href="#ref-hoogendoorn2017">2017</a>, for a discussion)</span>. Figure <a href="features.html#fig:fig8f">8.6</a> illustrates the linear interpolation approach: missing values (marked by red dots) are replaced by values that lie between the non-missings. Imagine that we would have used the mean to impute. Can you see why that would have disrupted local patterns in the series?</p>
<div class="figure" style="text-align: center"><span id="fig:fig8f"></span>
<img src="features_files/figure-html/fig8f-1.png" alt="EMA time series, with missing values (red) imputed through interpolation." width="100%" />
<p class="caption">
Figure 8.6: EMA time series, with missing values (red) imputed through interpolation.
</p>
</div>
</div>
<div id="auto-correlation" class="section level2">
<h2><span class="header-section-number">8.5</span> Auto-correlation</h2>

<p>When a series is correlated with delayed copies of itself, we say that it is auto-correlated. In repeated measurements of natural phenomena, this auto-correlation can often be found. The temperature of today is correlated with the temperature of recent days. Similarly, EMA mood ratings, taken at time t, are typically correlated with ratings taken at t-1, t-2, etc. Studying the auto-correlation of a time-series at different delays can be very revealing, as illustrated by the auto-correlation plot in Figure <a href="features.html#fig:fig8g">8.7</a>, in which the correlation of the EMA series with itself is plotted, for various delays (or ‘lags’ as these delays are called). First, the plot reveals that observations are correlated with previous values at lag 1: this series is auto-correlated. Second, there appears to be a pattern in the correlations at later lags: positive and negative correlations alternate, in a pattern that seems to reflect periodicity.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8g"></span>
<img src="features_files/figure-html/fig8g-1.png" alt="Autocorrelation plot of the EMA mood series, revealing periodicity." width="100%" />
<p class="caption">
Figure 8.7: Autocorrelation plot of the EMA mood series, revealing periodicity.
</p>
</div>
<div id="rolling-statistics" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Rolling Statistics</h3>
<p>From the auto-correlation analysis, we learned that describing the EMA series as a simple trend might be too simplistic. The mean does not increase in a simple linear fashion. There seem to be periodic components in the series as well: the signal appears also to be characterized by a series of increases and decreases in the mean mood level. In the plot of the raw series, this is not immediately clear. However, if we “smooth” the series, by calculating the mean as it develops over time, the periodicity in the series is becoming more clear. Figure <a href="features.html#fig:fig8h">8.8</a> illustrates this.</p>
<div class="figure" style="text-align: center"><span id="fig:fig8h"></span>
<img src="features_files/figure-html/fig8h-1.png" alt="EMA mood series, with a rolling mean superposed." width="100%" />
<p class="caption">
Figure 8.8: EMA mood series, with a rolling mean superposed.
</p>
</div>
</div>
</div>
<div id="periodicity" class="section level2">
<h2><span class="header-section-number">8.6</span> Periodicity</h2>

<p>Both the auto-correlation analysis and the moving average plot suggest periodicity in the EMA time series. Suppose we want to know more about this periodicity. Is there a way to quantify it? Yes, there is. With a technique called Fourier Analysis, the strength (‘power’) of various frequencies can be quantified. Figure <a href="features.html#fig:fig8i">8.9</a> shows what happens if we run a Fourier analysis of our time series (with R’s built-in function <code>spec.pgram</code>).</p>
<div class="figure" style="text-align: center"><span id="fig:fig8i"></span>
<img src="features_files/figure-html/fig8i-1.png" alt="periodogram of the EMA time series, revealing a one-day and a one-week period." width="100%" />
<p class="caption">
Figure 8.9: periodogram of the EMA time series, revealing a one-day and a one-week period.
</p>
</div>
<p>There are two peaks in the figure: at a frequency of 1 (day) and at a frequency of 0.14 (about one week). This series is <em>circadian</em>: mood ratings follow a daily and a weekly pattern. This is a common feature of EMA data, because of the circadian rhythms in our body and in our environment (our biological clocks, day-night cycles, seasons) <span class="citation">(Doherty, <a href="#ref-Doherty2018">2018</a>; Frank, Swartz, &amp; Boland, <a href="#ref-Frank2007">2007</a>; Frank, Swartz, &amp; Kupfer, <a href="#ref-Frank2000">2000</a>; Karatsoreos, <a href="#ref-Karatsoreos2014">2014</a>; Tahmasian et al., <a href="#ref-Tahmasian2013">2013</a>; Van Someren, <a href="#ref-VanSomeren2000">2000</a>)</span>.</p>
</div>
<div id="discussion" class="section level2">
<h2><span class="header-section-number">8.7</span> Discussion</h2>
<p>In this chapter, we used a number of statistical indicators to characterize a single time-series. By extracting these indicators (or “features”), we identified several regularities. We learned that the mean, variance and missingness increased over time, and we identified clear signs of circadian rhythmicity. You might have identified some of these features when you first inspected Figure <a href="features.html#fig:fig8a">8.1</a>. The increase in the mean was pretty easy to spot. However, the systematic increases in the variance and the missingness were less clear. Likewise, although you might have spotted the periodicity in the series, the circadian components were probably too subtle to spot for the naked eye.</p>
<p>The aim of the chapter was to illustrate the options available to the EMA researcher to quantitatively summarize EMA series. Other options, of course, exist. In chapter <a href="csd.html#csd">10</a>, for example, we will see how subtle changes in variation and auto-correlation in EMA mood scores can be summarized in a single dynamic statistical feature that may be predictive indicator of significant future state changes.</p>
<p>Finally, you might have been disappointed by the lack of code examples in this chapter. We did not include them, to avoid unnecessary distraction from the conceptual explanation. Instead, we provide a full code listing below, to allow you learn how to apply the feature extraction techniques yourself.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## (De)constructing a simulated EMA time-series

<span class="co"># libraries ----------------</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(gridExtra)
<span class="kw">library</span>(psych)
<span class="kw">library</span>(zoo)

<span class="co"># simulate the signal -------</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
n_measurements_per_day &lt;-<span class="st"> </span><span class="dv">5</span>
n_days &lt;-<span class="st"> </span><span class="dv">21</span>
n &lt;-<span class="st"> </span>n_measurements_per_day <span class="op">*</span><span class="st"> </span>(n_days)
m &lt;-<span class="st"> </span><span class="dv">3</span>
sdev_min &lt;-<span class="st"> </span><span class="dv">1</span>
sdev_max &lt;-<span class="st"> </span><span class="dv">4</span>
trend  &lt;-<span class="st"> </span><span class="dv">3</span>
missingness_prob =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>)
autocorrelation =<span class="st"> </span>.<span class="dv">6</span>

## time
t &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, (n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">by =</span>  <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">5</span>)

## signal
s &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(t))

## periodicity
s &lt;-<span class="st"> </span><span class="kw">seq</span>(sdev_min, sdev_max, <span class="dt">length.out =</span> n) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(<span class="dv">1</span>   <span class="op">*</span><span class="st"> </span>t <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)
s &lt;-
<span class="st">  </span>s <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">seq</span>(sdev_min, sdev_max, <span class="dt">length.out =</span> n) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">7</span> <span class="op">*</span><span class="st"> </span>t <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)

## mean + trend + sd (heteroscedastic)
s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n,
               <span class="dt">mean =</span> <span class="kw">seq</span>(m, m <span class="op">+</span><span class="st"> </span>trend, <span class="dt">length.out =</span> n),
               <span class="dt">sd =</span> <span class="fl">0.5</span>)

<span class="co">#3 auto-correlation</span>
s &lt;-<span class="st"> </span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">arima.sim</span>(<span class="dt">model =</span> <span class="kw">list</span>(<span class="dt">ar =</span> autocorrelation), <span class="dt">n =</span> n)

## missingness
m1 &lt;-
<span class="st">  </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="kw">seq</span>(missingness_prob[<span class="dv">1</span>], missingness_prob[<span class="dv">2</span>], <span class="dt">length.out =</span> n))
s[m1 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>

## in range
s[s <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>] &lt;-<span class="st"> </span><span class="dv">10</span>
s[s <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span>

## combine in data.frame
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(t, s)

<span class="co"># plot -------------------------</span>
e &lt;-<span class="st"> </span><span class="kw">subset</span>(d,<span class="op">!</span><span class="kw">is.na</span>(s))

<span class="co"># raw series </span>
<span class="kw">ggplot</span>(e, <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> s)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;mood&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;days&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


<span class="co"># plot mean and variance --------</span>
<span class="kw">ggplot</span>(e, <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> s)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">mean</span>(e<span class="op">$</span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(
    <span class="dt">yintercept =</span> <span class="kw">mean</span>(e<span class="op">$</span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(e<span class="op">$</span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,
    <span class="dt">linetype =</span> <span class="dv">2</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(
    <span class="dt">yintercept =</span> <span class="kw">mean</span>(e<span class="op">$</span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">sd</span>(e<span class="op">$</span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,
    <span class="dt">linetype =</span> <span class="dv">2</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="co">#geom_line() +</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;mood&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;days&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


## The trends ---------------------

## run a linear regression of mood ratings by time
fm =<span class="st"> </span><span class="kw">lm</span>(s <span class="op">~</span><span class="st"> </span>t, e)

## mean
<span class="kw">ggplot</span>(e, <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> s)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">intercept =</span> <span class="kw">coef</span>(fm)[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(<span class="kw">resid</span>(fm)),
    <span class="dt">slope =</span> <span class="kw">coef</span>(fm)[<span class="dv">2</span>],
    <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,
    <span class="dt">linetype =</span> <span class="dv">2</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">intercept =</span> <span class="kw">coef</span>(fm)[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="kw">sd</span>(<span class="kw">resid</span>(fm)),
    <span class="dt">slope =</span> <span class="kw">coef</span>(fm)[<span class="dv">2</span>],
    <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,
    <span class="dt">linetype =</span> <span class="dv">2</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;mood&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;days&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


## residuals
e<span class="op">$</span>residuals &lt;-<span class="st"> </span><span class="kw">rstandard</span>(fm)
e<span class="op">$</span>week &lt;-<span class="st"> </span>(e<span class="op">$</span>t <span class="op">%/%</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

<span class="kw">ggplot</span>(<span class="kw">subset</span>(e, week <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>), <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> <span class="kw">abs</span>(residuals))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;absolute residuals&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;week&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


<span class="co"># Missing values ----------------------</span>

d<span class="op">$</span>t_g &lt;-<span class="st"> </span><span class="kw">cut</span>(t, <span class="dv">21</span>, <span class="dt">labels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">21</span>)
p &lt;-<span class="st"> </span><span class="kw">prop.table</span>(<span class="kw">table</span>(d<span class="op">$</span>t_g, <span class="kw">is.na</span>(d<span class="op">$</span>s)), <span class="dv">1</span>)
p &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(p)
p &lt;-<span class="st"> </span><span class="kw">subset</span>(p, Var2 <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
fm2 &lt;-<span class="st"> </span><span class="kw">lm</span>(p<span class="op">$</span>Freq <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(p<span class="op">$</span>Var1))

<span class="kw">ggplot</span>(p, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(Var1), <span class="dt">y =</span> Freq <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;missed ratings (%)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;days&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


## imputation through interpolation
impute_interpolation &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">require</span>(zoo)
  
  y =<span class="st"> </span><span class="kw">zoo</span>(x)
  
  <span class="co"># fill initial and trailing NA</span>
  <span class="cf">if</span> (<span class="kw">is.na</span>(y[<span class="dv">1</span>]))
    y[<span class="dv">1</span>] =<span class="st"> </span>y[<span class="kw">which.max</span>(<span class="op">!</span><span class="kw">is.na</span>(y))]
  <span class="cf">if</span> (<span class="kw">is.na</span>(y[<span class="kw">length</span>(y)]))
    y[<span class="kw">length</span>(y)] =<span class="st"> </span>y[<span class="kw">max</span>((<span class="op">!</span><span class="kw">is.na</span>(y)) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(y)))]
  
  <span class="co"># interpolate</span>
  y_ =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">na.approx</span>(y))
  
  y_
}


d<span class="op">$</span>s_imputed &lt;-<span class="st"> </span><span class="kw">impute_interpolation</span>(d<span class="op">$</span>s)
<span class="kw">ggplot</span>(d, <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> s_imputed)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="kw">is.na</span>(s))) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


<span class="co"># Autocorrelation ---------------------------</span>
<span class="kw">acf</span>(e<span class="op">$</span>s,
    <span class="dt">type =</span> <span class="st">&quot;partial&quot;</span>,
    <span class="dt">lag.max =</span> <span class="dv">35</span>,
    <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)


<span class="co"># Rolling mean ------------------------------</span>
d<span class="op">$</span>rolling_mean &lt;-
<span class="st">  </span><span class="kw">as.numeric</span>(
    zoo<span class="op">::</span><span class="kw">rollapply</span>(
      <span class="kw">as.numeric</span>(d<span class="op">$</span>s),
      <span class="dt">width =</span> <span class="dv">5</span>,
      <span class="dt">FUN =</span> <span class="cf">function</span>(x)
        <span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
      <span class="dt">fill =</span> <span class="ot">NA</span>,
      <span class="dt">align =</span> <span class="st">&quot;right&quot;</span>,
      <span class="dt">partial =</span> <span class="ot">TRUE</span>
    )
  )

e &lt;-<span class="st"> </span><span class="kw">subset</span>(d,<span class="op">!</span><span class="kw">is.na</span>(s))
<span class="kw">ggplot</span>(e, <span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> rolling_mean)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> s), <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">size =</span> .<span class="dv">8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Mood (rolling mean)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;days&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())


<span class="co"># Frequency analysis --------------------------</span>

fa &lt;-
<span class="st">  </span><span class="kw">spec.pgram</span>(
    <span class="kw">ts</span>(<span class="kw">impute_interpolation</span>(d<span class="op">$</span>s), <span class="dt">frequency =</span> n_measurements_per_day),
    <span class="dt">detrend =</span> <span class="ot">TRUE</span>,
    <span class="dt">demean =</span> <span class="ot">TRUE</span>,
    <span class="dt">main =</span> <span class="st">&quot;periodogram&quot;</span>,
    <span class="dt">sub =</span> <span class="st">&quot;&quot;</span>,
    <span class="dt">xlab =</span> <span class="st">&quot;frequency&quot;</span>,
    <span class="dt">log =</span> <span class="st">&quot;no&quot;</span>,
    <span class="dt">ylab =</span> <span class="st">&quot;power&quot;</span>,
    <span class="dt">type =</span> <span class="st">&quot;h&quot;</span>,
    <span class="dt">spans =</span> <span class="ot">NULL</span>,
    <span class="dt">taper =</span> <span class="fl">0.01</span>,
    <span class="dt">ci =</span> <span class="ot">FALSE</span>
  )</code></pre></div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-bowen2006">
<p>Bowen, R., Baetz, M., Hawkes, J., &amp; Bowen, A. (2006). Mood variability in anxiety disorders. <em>Journal of Affective Disorders</em>, <em>91</em>(2-3), 165–170. <a href="https://doi.org/10.1016/j.jad.2005.12.050" class="uri">https://doi.org/10.1016/j.jad.2005.12.050</a></p>
</div>
<div id="ref-wikiStationary">
<p>Wikipedia. (2018). Stationary process — Wikipedia, The free encyclopedia. <a href="http://en.wikipedia.org/w/index.php?title=Stationary%20process&amp;oldid=866157327">http://en.wikipedia.org/w/index.php?title=Stationary%20process&amp;oldid=866157327</a>.</p>
</div>
<div id="ref-hoogendoorn2017">
<p>Hoogendoorn, M., &amp; Funk, B. (2017). <em>Machine learning for the quantified self: On the art of learning from sensory data</em>. Springer International Publishing. Retrieved from <a href="https://books.google.nl/books?id=WZs3DwAAQBAJ" class="uri">https://books.google.nl/books?id=WZs3DwAAQBAJ</a></p>
</div>
<div id="ref-Doherty2018">
<p>Doherty, A. (2018). Circadian rhythms and mental health: wearable sensing at scale. <em>The Lancet Psychiatry</em>. <a href="https://doi.org/10.1016/S2215-0366(18)30172-X" class="uri">https://doi.org/10.1016/S2215-0366(18)30172-X</a></p>
</div>
<div id="ref-Frank2007">
<p>Frank, E., Swartz, H. A., &amp; Boland, E. (2007). Interpersonal and social rhythm therapy: An intervention addressing rhythm dysregulation in bipolar disorder. <em>Dialogues in Clinical Neuroscience</em>. <a href="https://doi.org/10.1002/jclp.20371" class="uri">https://doi.org/10.1002/jclp.20371</a></p>
</div>
<div id="ref-Frank2000">
<p>Frank, E., Swartz, H. A., &amp; Kupfer, D. J. (2000). Interpersonal and social rhythm therapy: Managing the chaos of bipolar disorder. <em>Biological Psychiatry</em>. <a href="https://doi.org/10.1016/S0006-3223(00)00969-0" class="uri">https://doi.org/10.1016/S0006-3223(00)00969-0</a></p>
</div>
<div id="ref-Karatsoreos2014">
<p>Karatsoreos, I. N. (2014). Links between Circadian Rhythms and Psychiatric Disease. <em>Frontiers in Behavioral Neuroscience</em>. <a href="https://doi.org/10.3389/fnbeh.2014.00162" class="uri">https://doi.org/10.3389/fnbeh.2014.00162</a></p>
</div>
<div id="ref-Tahmasian2013">
<p>Tahmasian, M., Khazaie, H., Golshani, S., &amp; Avis, K. T. (2013). Clinical application of actigraphy in psychotic disorders: A systematic review. <em>Current Psychiatry Reports</em>. <a href="https://doi.org/10.1007/s11920-013-0359-2" class="uri">https://doi.org/10.1007/s11920-013-0359-2</a></p>
</div>
<div id="ref-VanSomeren2000">
<p>Van Someren, E. (2000). Circadian rhythms and sleep in human aging. <em>Chronobiology International</em>. <a href="https://doi.org/10.1081/CBI-100101046" class="uri">https://doi.org/10.1081/CBI-100101046</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="activity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lmm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["aph_ema.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
