# R & RStudio

In this chapter, you will learn how to install and use two programs that are
indispensable for the management and analysis of EMA data: R and RStudio. 


## What are R and RStudio?

R is a programming language and software environment for statistical computing
and data visualisation. 

R comes with a basic graphical user interface (RGui), but many people never use
it. RStudio, a powerful alternative user interface, has many useful features
that greatly simplify R-work. We strongly advise you to adopt the R/RStudio-
combo.


## Why R?

R is for data scientists, methodologists, and scientific programmers. It is
nerdy. It has a steep learning curve. If you are trained in SPSS, it will take
a lot of time to become as productive in R as in SPSS. Why invest in R?

- Unlike SPSS, R is free. It does not eat up your budget. Why pay for something
that you can get for free?

- R is cutting-edge. Methodological innovations first appear in R. Network
analyses, for example (see Chapter 9), can be run in R, but not (yet) in
SPSS. For some analyses, you need this alternative.

- Mastering R improves your connection to the statisticians in your team. They
probably prefer R over SPSS. It is more efficient and less error-prone to all
speak the same language.

- R is great for data-management. Clinical research, and especially EMA
research, requires hundreds of operations on multiple raw data files. R excels
at that. SPSS, frankly, does not. If you care about reproducible research (which
you should), R can be a great help in putting it into practice.

- R can be used at different levels. If you want to be a basic user, that's fine.
However, if you want to dive deeper, you will find that you can easily do so.
You can study source code to understand a particular technique better. You can
code new functions. R allows you to grow. 

- R's use base is expanding every year. Chances are high that R is the standard
in your next workplace. R will look great on your CV.

You don't have to be a programmer or methodologist to use R. It takes time
to master its full potential, but you should be able to run basic
analyses in it within a week. This chapter will get you started.


## Installing R & RStudio

Both R and RStudio are available, at no costs, for all major operating systems. 

- Download R from the Comprehensive R Archive Network (CRAN) at 
  https://cran.r-project.org/bin/

- Download RStudio from http://rstudio.org

Install R first, and RStudio second. If you install the programs in this order, 
RStudio will automatically find R on your computer.


## Interacting with R through the RStudio console

If you open RStudio, you will be presented with the interface shown in Figure
\ref{rstudio}. Rstudio's main window is divided in four panes (subwindows),
which further contain several tabbed windows. Your first session with R starts
in the bottom-left pane, named "Console".

![RStudio's User Interface.\label{rstudio}](images/R/rstudio.png){width=98%}

In the console, you send commands to R. It will execute the command immediately
and return the answer back in the console. To test this, move your cursor to
the bottom line, immediately after the prompt sign (">"). Next, type the simple
statement below, and press 'Enter'.

```{r cs21}
# Code snippet 2.1: R is a calculator.
1 + 1
```

Results of calculations can be saved into variables, by making use of the
assignment operator ("<-"). If you type the name of a variable, R returns its
value.

```{r cs22}
# Code snippet 2.2: Using <- to declare and set a variable,
N <- 50 + 50
N
```

To appreciate why R is such a popular tool for statistical computing, consider
the following command, which, in one line, 1) uses the variable N, just created,
to 2) generate 100 random numbers from the normal distribution, and 3) plot a
histogram of these numbers.

```{r cs23, eval = FALSE}
# Code snippet 2.3: Plotting the histogram of a sample from the normal 
# distribution.
hist(rnorm(N))
```

The plot appears in the bottom-right pane, as in Figure \ref{rstudio}. 


## Writing R-scripts
\index{scripts}

Working in the console is a great way to interactively explore R and data, but
what if you want to save a particularly useful chain of statements? For this,
you can use a script file.

To create a script file, use the RStudio menu: `File > New File > R Script`.
This will open a new tab in the top-right pane of RStudio, where you can edit
the script.

- In the script window, type all statements that you have been entering in the
console in the previous section.

- Next, select all lines in the script.

- Press `Ctrl+Enter` to run the script.

All commands in the script are executed. The commands are echoed in the console
pane, and results are shown immediately, as was the case before, when you typed
the commands in the Console yourself.

Scripts can also be run line by line. Set your cursor in the line you want to
run, and press "Ctrl+Enter". The line is copied to the console and executed,
and the cursor in the script will move to the next line, allowing you to walk
through the script, step by step.


## Importing your data
\index{Data import}

Something that confuses new Rstudio users, who are more familiar with SPSS, is
that it is not obvious how to import data into RStudio. In SPSS, the data
are in plain sight. In R, you first have to import the data. There are several
ways to do so.

### Using RStudio menu's to import data 

One way to load data into R is to use RStudio's data import wizard. Follow the
steps below to see how this works with data stored in a comma-separated-values
(csv) format, a common data format to which many programs, including SPSS and
Excell, can export data to.
 
- Download the example csv data file at https://tinyurl.com/ybfafxxk (or create
a csv-version of one of your own data files).

- In RStudio, choose the menu option `File > Import Dataset > From Text (base)`.

- In the window that appears, click on `Browse` to locate the csv-
file on your computer, and click `Import` in the next window (see Figure
\ref{rstudiocsvimport}).

RStudio shows the data, in tabular view, in the top-left window, ready for
further analysis. You will also find a new entry in the `Environment`-tab in
the top-right pane. When you click the small arrow, at the left of the name, you
will see a brief summary of the contents of the data.

![RStudio's CSV import wizard.\label{rstudiocsvimport}](images/R/csv_import.png){width=98%}

### Using functions to import data

While RStudio's Data import wizard is useful, you will probably use it less if
you get more experienced in R. Most likely, you will convert to using the more
efficient R commands to import data. For example, it takes only a single line to
download and import the example data.

```{r cs24}
# Code snippet 2.4: importing csv-data from the internet.
ESMdata <- read.csv(url("https://tinyurl.com/ybfafxxk"), row.names = NULL)
```


### Accessing your data

Since the data is now in the environment (under the name `ESMdata`), you can use
it in other R commands. For example, to produce a more detailed summary of the
first four columns of `ESMdata`, you type:

```{r cs25, comment = NA}
# Code snippet 2.5: summarising data.
summary(ESMdata)
```

To inspect the first 6 lines of data, type,

```{r cs26, eval = TRUE}
# Code snippet 2.6: Show first 6 lines of a data frame.
head(ESMdata)
```

To view all rows of data in a spreadsheet (as in Figure \ref{rstudiocsvimport}),
type:

```{r cs27, eval = FALSE}
# Code snippet 2.7: Show data as spreadsheet.
View(ESMdata)
```

To work with a specific variable in the dataset, use '$', For instance, to print
the first 20 numbers in the `mood_relaxed` variable, type:

```{r cs28, eval = FALSE}
# Code snippet 2.8: accessing a single variable in a data frame.
head(ESMdata$mood_relaxed, n = 20)
```

This allows you to apply functions to specific variables. For example, to
calculate the mean of scores in `mood_relaxed`, type:

```{r cs29}
# Code snippet 2.19: Calculating the mean of a variable.
mean(ESMdata$mood_relaxed)
```

There are, of course, many ways in which you can summarise and manipulate your
data. At this point, the important milestone is that you imported
and accessed your data in R.


## Extending R with Packages
\index{packages}

R's attractiveness lies in the ease with which it can be extended with new
functionality. Through so-called packages, which can be freely downloaded from
the internet, specialised functions can be added to your workspace.

### Installing R-packages from CRAN

Packages can be found at the CRAN website. To browse through the impressive list
of available packages, see 
https://cran.r-project.org/web/packages/available_packages_by_name.html

If you find a package you like, you can install it via the RStudio menu
system, choosing `Tools > packages`. But you can also use the console, via the
`install.package` function. 

A popular package, `tidyverse`, is used extensively in the examples of this
manual. Package tidyverse comprises a set of popular packages from the creators
of RStudio, that greatly simplify working with R. So, while you are at it,
install this package now.

```{r cs210, eval = FALSE}
# Code snippet 2.10: installing a package from CRAN.
install.package(tidyverse)
```

The tidyverse contains a package called 'haven', which allows you to read and
write SPSS datafiles (.sav files). This is very convenient. You don't have to
convert all your SPSS data to csv files. See `?read_spss` to learn how to import
an SPSS-file (or use the data import wizard, by choosing `File > Import
Dataset > From SPSS', in RStudio's top-right pane).


### Installing R-packages from GitHub
\index{GitHub}

Not all packages are at CRAN. Many 'unoffical' packages are shared
at a site called 'GitHub'. This book's companion R package 'emaph', for example,
which contains specialised EMA functions datasets, is on GitHub. You need package emaph to run many examples in the book, so let's install this package now.

GitHub packages can be installed via the `install_github` function, which is
defined in a package called 'devtools'. So, to install 'emaph', enter the following in the console:

```{r cs211, eval = FALSE}
# Code snippet 2.11: Install a package from GitHub.
install.packages("devtools")
devtools::install_github("jruwaard/emaph")
```


### Using packages

To use packages, you have to tell R to load them. You do this with the `library`
function. For example, to use package 'tideverse' and 'emaph', type:

```{r cs212, eval = TRUE}
# Code snippet 2.12: Loading packages.
library(tidyverse)
library(emaph)
```

Once loaded, you can use the functions in the packages. From the documentation
of emaph (type: `?emaph`), you learn that this package contains several example
EMA datasets. Dataset 'csd' (see `?csd`) contains the data from the 'critical
slowing down'-study [@Kossakowski2017; @Wichers2016], in which a patient
recorded his mood for 239 days (see also Chapter 13).

To plot the irritation levels of this patient in the first six days, using the
`ggplot` function from package 'ggplot2' (which is in 'tidyverse'), type:

```{r cs213, eval = TRUE, warning = FALSE, fig.cap = "Irritation levels of a single patient, in the first six days of an EMA study.", fig.asp = 0.4}
# Code snippet 2.13: Using ggplot to plot EMA time series.
ggplot(data = subset(csd, dayno <= 6),
       mapping =  aes(x = beepno, y = mood_irritat)) + 
  geom_point() +  geom_step() + 
  scale_x_continuous(breaks = 1:10) +
  facet_wrap(~ dayno, nrow = 2)
```

## Getting help
\index{help}

Unlike SPSS, R has no point-and-click menu's that you can browse through to
select a statistical procedure. This is a problem for many new users. What if
you want, for example, to generate random numbers from a distribution with a
mean of 2 and standard deviation of 4? How to tell this to R?


### Using '?' to consult the documentation

The good thing is that you already known the name of the function to use, since
we used it in the previous section: it is `rnorm`. To check the documentation of
this function, type `?rnorm` in the console.

```{r cs214, eval = FALSE}
# Code snippet 2.14: Using '?' to find the documentation of a function.
?rnorm
```

This opens the documentation of the rnorm function in the 'Help'-tab, in the
bottom right pane, from which you learn that that the `rnorm` function accepts
`mean` and `sd` (standard deviation) as additional parameters, which are 0 and
1 default, respectively (which explains why `norm(100)`
worked in the previous examples). So, to generate the required numbers, you
type:

```{r cs215, eval = FALSE}
# Code snippet 2.15: Plotting the histogram of a custom random sample
hist(rnorm(1000, mean = 2, sd = 4))
```

All functions in R are documented, and this documentation is shown in RStudio's
Help pane when you prepend ? to the name of the function in the console.


### Using RStudio's global documentation index search

What if you do not know the name of a function? Suppose you want to run a t-test
for independent groups. Does R have a function for that?

At the top-right of the 'Help' pane, RStudio has a search input field, which
allows you to search through all documentation that is installed on your
computer. The search field auto-completes your input. If you type a 't' in this
field, you will be presented with a list of functions starting with a 't'. In
this list, you find a likely candidate: a function called `t.test`. From the
documentation of this function (`?t.test`), you learn that, indeed, this is the
function you were looking for.

```{r cs216}
# Code snippet 2.16: Running a t-test, on two simulated samples.

# generate two samples (N = 100 per group) from the normal distribution
A <- rnorm(100); B <- rnorm(100)

# the t-test should be non-significant 
t.test(A, B)
```

### Google 

With Google, you will find most answers to your R questions online. Googling
for "t test R", for example, results in a very rich set of online resources. You
will find that some resources provide you with more and better quality answers.
Good resources are:

- RSeek (see http://rseek.org/)

- Stackoverflow: (see https://stackoverflow.com/questions/tagged/r)

- SearchR (see: http://search.r-project.org/)


## Next steps

Not all functions carry clear-cut names. Many are not easily located via a
simple search. One reason why R is said to have a steep learning curve is that
it requires you to develop a vocabulary of statements that are acceptable to R.
You have to learn how to speak the language. This takes time.

Build your vocabulary by reading books (see the end of this chapter), using
Cheatsheets (lists of useful commands; see, for example 
https://www.rstudio.com/resources/cheatsheets/), or by browsing the extensive documentation built into R (type: `help.start()` in the console) and Rstudio 
(see the 'Help' menu option).


### Learning from examples

This manual contains many R code snippets. You now know how to run these in
RStudio. By studying these examples (or other code examples you find on the
internet), you will become more familar with R.

Many examples will introduce R language constructs and functions that are unknown
to you. Learn from from these examples, by using `?` on each element that you do
not understand.

For example, consider the example below, which shows R code to reveal how hungry
the patient in the 'csd' study was over the course of the day. It contains a lot
of statements that weren't discussed yet. Table \ref{tab:usingrhelp} shows how
`?` can help to understand the code and its output.

```{r cs217, warning = FALSE, fig.cap = "Reported hunger levels, over the course of the day, of a single respondent.", fig.asp = 0.3}
# Code snippet 2.17: Another ggplot example.
ggplot(data = csd, mapping = aes(x = resptime_s, y = phy_hungry)) + 
  geom_jitter(height = .2, size = .5) + 
  geom_smooth()
```


Table: (\#tab:usingrhelp) Using R Help to understand code snippets.

+-------------------+----------------------------------------------------------+
| Help              | What you can learn from the documentation                |
+:==================+:=========================================================+
| ?ggplot           | `ggplot` creates a new plot from data in 'csd'.          |
|                   | The variable `hour` from 'csd' is used as x.             |
|                   | The variable 'phy_hungry' from 'csd' is used as y.       |
|                   | Calling `ggplot` plots the coordinate system, but not    |
|                   | much more. 
+-------------------+----------------------------------------------------------+
| ?csd              | Variable `resptime_s` marks the time when the question   |
|                   | was answered by the patient.                             |
|                   | Variable `phy_hungry` contains the response of the       |
|                   | patient to the statement 'I am hungry.'                  |
+-------------------+----------------------------------------------------------+
| ?geom_jitter      | This command plots the (x, y) data points, with a small  |
|                   | amount of random variation (on both x and y).            |
|                   | Since y-scores are discrete, on a 1 to 7 scale, without  |    
|                   | jittering, many points would overlap, making it difficult|
|                   | to see the density of scores. To further reduce the      |
|                   | cluttering, points are plotted smaller (`size = .5`).    |
+-------------------+----------------------------------------------------------+
| ?geom_smooth      | Plots a smoothed line through the (x, y) data points.    |
|                   | The gray area around the blue lines marks the 95\%       |
|                   | confidence interval.                                     |
+-------------------+----------------------------------------------------------+


### Read books

This manual does not provide a comprehensive training in R and RStudio. There is
no need for that, since excellent resources are readily available. A selection
is presented below.

- Many mental health researchers own a copy of Andy Field's popular book
"Discovering Statistics Using IBM SPSS Statistics" [@FieldSPSS]. For those,
Field's R-version of this book, "Discovering Statistics Using R" [@FieldR]
provides a familiar companion in making the transition to R. See 
https://www.discoveringstatistics.com/

- Free manuals can be found at the offical CRAN site. The manuals are dry, and
not for the faint of heart, but complete and authorative, since the authors
are members of the R core development team. See https://cran.r-project.org/
manuals.html (or type `help.start()` in the console - the manuals are already on
your computer).

- While at CRAN, be sure to browse the 'contributed documentation'-section as
well. On this page, you will find many freely available manuals contributed by
the R community. See https://cran.r-project.org/other-docs.html


### Online Courses

- DataCamp, an online data science education platform, offers several high-
quality courses in R. See http://www.datacamp.com

- The Try-R course at the CodeSchool website provides an alternative to the
interactive courses of DataCamp. See: http://tryr.codeschool.com/

- The Quick-R website provides a solid, concise, and rich
introduction to R. See https://www.statmethods.net/


### Learn R in R

Package 'swirl' comprises a set of interactive courses that teach many aspects
of the R language. See http://swirlstats.com

```{r cs218, eval = FALSE}
# Code snippet 2.18: starting the interactive swirl-course in R.
install.packages("swirl")
library("swirl")
swirl()
```





